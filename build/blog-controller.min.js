/*! chewieez.github.io 2017-11-20 */

$.ajax({url:"https://personal-site-60774.firebaseio.com/blogArray.json"}).then(function(e){function t(e){s.forEach(t=>{let n=t.title.toLowerCase(),l=t.content.toLowerCase();n.includes(e)||l.includes(e)?c.push(t):console.log("can't find one")})}function n(){function e(e){i.innerHTML="";const t=parseInt(Array.from(e.target.classList).find(e=>{if(e.startsWith("page-"))return e}).split("-")[1]);t-1==0?d.style.visibility="hidden":(d.style.visibility="visible",d.className=`page-${t-1}`),t+1>s?g.style.visibility="hidden":(g.style.visibility="visible",g.className=`page-${t+1}`);const l=c.slice((t-1)*n,t*n);0===l.length?i.innerHTML="\n                    <p>No blog entries match your search parameters. </p>\n                    ":l.forEach(e=>{let t=moment(e.published).format("dddd, MMMM Do YYYY");i.innerHTML+=`\n                    <article  id="blogPost-${e.id}">\n                            <h4 class="blog-title">${e.title}</h4>\n                            <p class="blog-subheading"><span class="special-text">by:</span> ${e.author}    <span class="special-text">published on:</span> ${t}</p>\n                            \n                            `,e.content.length>470?i.innerHTML+=`\n                        <div id="blogContent-${e.id}" class="abridged">\n                            <p class="blog-content">${e.content}</p>\n                        </div>\n                        <button id="expandContent-${e.id}" class="expandContentBtn">Click to read more</button>\n                        `:i.innerHTML+=`\n                        <div id="blogContent-${e.id}">\n                            <p class="blog-content">${e.content}</p>\n                        </div>\n                        `,i.innerHTML+=`\n                    <p class="blog-tags">tags: ${e.tags}</p>\n                    <hr>\n                    </article>\n                    `})}let t=c.length;const n=5;let s=Math.ceil(t/n);const o=document.getElementById("blogPaginator");let a="<ul>";a+="<li><a id='previous' href='#'>&lt;</a></li>";for(var r=0;r<s;r++)a+=` <li><a class="blogPage page-${r+1}" href="#">${r+1}</a></li>`;a+="<li><a id='next' class='page-2' href='#'>&gt;</a></li>",a+="</ul>",o.innerHTML=a;const d=document.getElementById("previous"),g=document.getElementById("next"),p=document.getElementsByClassName("blogPage");for(let t=0;t<p.length;t++)p[t].addEventListener("click",e);e({target:{classList:["page-1"]}}),d.addEventListener("click",e),g.addEventListener("click",e),i.addEventListener("click",l)}function l(e){let t=e.target.id,n=e.target;const l=t.split("-")[1];t.startsWith("expandContent-")&&(document.getElementById("blogContent-"+l).classList.toggle("abridged"),n.innerHTML.includes("more")?n.innerHTML="Click to see less":n.innerHTML.includes("less")&&(n.innerHTML="Click to read more"))}const s=e;let i=document.getElementById("blog-view"),o=document.getElementById("blog-entries-list"),a=(document.getElementById("no-results-msg"),document.getElementById("search-input")),c=s;a.addEventListener("keyup",function(e){c=[];let l=a.value.toLowerCase();console.log("searchQuery =",l),a.value.length>=3?(t(l),console.log("blogSearchResults = ",c),n()):(c=s,n())}),n(),o.innerHTML="",s.forEach(e=>{let t=moment(e.published).format("dddd, MMMM Do YYYY");o.innerHTML+=`\n        <p><a href="#">${t}</a></p>\n        `})});